deployment:
  keycloak:
    env:
      kcDb: mssql
      kcDbPassword: 'EXAMPLE_KCDB_PASS8675309'
      kcDbUrl: jdbc:sqlserver://EXAMPLE_DB_ENDPOINT:1433;databaseName=keycloak;encrypt=true;trustServerCertificate=true;
      kcDbUsername: NBS_keycloak
      kcHealthEnabled: "true"
      kcHostnameStrict: "false"
      kcHttpEnabled: "false"
      kcHttpRelativePath: /auth
      kcMetricsEnabled: "true"
      kcTransactionXaEnabled: "false"
      keycloakAdmin: admin
      keycloakAdminPassword: "EXAMPLE_KC_PASS8675309"
      kcProxyHeaders: xforwarded
    image:
      repository: quay.io/keycloak/keycloak
      tag: 24.0.4
  replicas: 1

# this will load the theme, edit for the current release number
initContainers:
  enabled: true
  image: "alpine:3.12"
  # not used yet
  themeUrl: "https://github.com/CDCgov/NEDSS-Modernization/archive/refs/tags/v7.5.0.zip"  # URL to the theme archive
  command:
    - /bin/sh
    - -c
    - |
      # clean up all cruft, only uncomment if needed
      #rm -rf /keycloak/themes/*
      
      # brute force cleanup
      rm -rf /keycloak/themes/nbs
      rm -rf /keycloak/themes/login

      # add needed packages
      apk update
      apk add --no-cache curl unzip

      # download zip file, hardcoding for testing
      #curl --output /theme.zip -L {{ .Values.initContainers.themeUrl }}

      #################################################################################################
      # current kludge only works when release is finalized - will be done
      # differently next release - cm
      #curl --output /keycloak/themes/theme.zip -L https://github.com/CDCgov/NEDSS-Modernization/archive/refs/tags/v7.4.4.zip
      curl --output /keycloak/themes/theme.zip -L https://github.com/CDCgov/NEDSS-Modernization/archive/refs/tags/v7.5.0.zip

      #unzip /keycloak/themes/theme.zip 'NEDSS-Modernization-7.4.4/cdc-sandbox/keycloak/theme/nbs/*' -d /keycloak/themes
      unzip /keycloak/themes/theme.zip 'NEDSS-Modernization-7.5.0/cdc-sandbox/keycloak/theme/nbs/*' -d /keycloak/themes

      #cp -pr  /keycloak/themes/NEDSS-Modernization-7.4.4/cdc-sandbox/keycloak/theme/nbs/login /keycloak/themes/
      cp -pr  /keycloak/themes/NEDSS-Modernization-7.5.0/cdc-sandbox/keycloak/theme/nbs/login /keycloak/themes/

      # cleanup 
      #rm -rf /keycloak/themes/NEDSS-Modernization-7.4.4
      rm -rf /keycloak/themes/NEDSS-Modernization-7.5.0
      rm -rf /keycloak/themes/theme.zip
keycloak:
  ports:
  - name: http
    port: 80
    protocol: TCP
    targetPort: 8080
  type: ClusterIP
kubernetesClusterDomain: cluster.local


cloudProvider: aws

azure:
  files:
    storageRequest: 1Gi
    storageAccountName: 
    resourceGroupName: 

#AWS PVC Settings

pvc:
  kcPvClaim:
    storageClass: efs-kc
    storageRequest: 1Gi

efsFileSystemId: "EXAMPLE_EFS_ID"

