# ================================================
# Global configuration
# ================================================
global:
  replicaCount: 1
  env: prod              # Environment indicator
  timezone: UTC          # Container timezone

  imagePullSecrets: [ ]

  # Secrets must be set before containers are deployed using. We suggest filling out /k8-manifests/nbs-secrets.yaml manifest
  # Referencing secrets requires using the secret name and key separately.
  # Under the secrets block provide the secret name and the keys
  secrets:
    secretName: "rtr-access"
    dburl:
      odse: "odse_url"
      rdb: "rdb_url"
    kafka:
      cluster: "kafka-cluster-url"

  image:
    repository: ""
    tag: "1.0.1-SNAPSHOT.d96d4e7"

  serviceAccount:
    create: true
    annotations: { }
    name: ''

  podAnnotations:
    prometheus.io/scrape: 'true'
    prometheus.io/path: /actuator/prometheus
    prometheus.io/port: '8081'

  resources:
    limits:
      memory: "512Mi"
      cpu: "250m"
    requests:
      memory: "256Mi"
      cpu: "125m"

  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80

  nodeSelector: { }
  tolerations: [ ]
  affinity: { }

  probes:
    readiness:
      enabled: true
    liveness:
      enabled: true

# ================================================
# Service-specific configurations
# ================================================
services:

  # ----------------------------------------
  # Investigation Reporting Service
  # ----------------------------------------
  investigation-reporting:
    secrets:
      jdbc:
        secretName: "rtr-access"
        username: "investigation_reporting_user"
        password: "investigation_reporting_pass"
    service:
      port: 8093
      httpsPort: 443
    serviceAccount:
      create: true
      name: ''
      annotations: { }
    featureFlag:
      phcDatamartEnable: "true"
    log:
      path: /usr/share/investigation-reporting/data
    probes:
      readiness:
        enabled: true
        path: /reporting/investigation-svc/status
        initialDelaySeconds: 60
        periodSeconds: 10
        failureThreshold: 5
      liveness:
        enabled: true
        path: /reporting/investigation-svc/status
        initialDelaySeconds: 60
        periodSeconds: 30
        failureThreshold: 5
    image:
      repository: "quay.io/us-cdcgov/cdc-nbs-modernization/data-reporting-service"
      name: "investigation-reporting-service"
      tag: "v1.1.9"
      pullPolicy: IfNotPresent

  # ----------------------------------------
  # LDF Data Reporting Service
  # ----------------------------------------
  ldfdata-reporting:
    secrets:
      jdbc:
        secretName: "rtr-access"
        username: "ldfdata_reporting_user"
        password: "ldfdata_reporting_pass"
    service:
      port: 8097
      httpsPort: 443
    serviceAccount:
      create: true
      name: ''
      annotations: { }
    log:
      path: /usr/share/ldfdata-reporting/data
    probes:
      readiness:
        enabled: true
        path: /reporting/ldfdata-svc/status
        initialDelaySeconds: 60
        periodSeconds: 10
        failureThreshold: 5
      liveness:
        enabled: true
        path: /reporting/ldfdata-svc/status
        initialDelaySeconds: 60
        periodSeconds: 30
        failureThreshold: 5
    image:
      repository: "quay.io/us-cdcgov/cdc-nbs-modernization/data-reporting-service"
      name: "ldfdata-reporting-service"
      tag: "v1.1.9"
      pullPolicy: IfNotPresent


  # ----------------------------------------
  # Observation Reporting Service
  # ----------------------------------------
  observation-reporting:
    secrets:
      jdbc:
        secretName: "rtr-access"
        username: "observation_reporting_user"
        password: "observation_reporting_pass"
    service:
      port: 8094
      httpsPort: 443
    serviceAccount:
      create: true
      name: ''
      annotations: { }
    log:
      path: /usr/share/observation-reporting/data
    probes:
      readiness:
        enabled: true
        path: /reporting/observation-svc/status
        initialDelaySeconds: 60
        periodSeconds: 10
        failureThreshold: 5
      liveness:
        enabled: true
        path: /reporting/observation-svc/status
        initialDelaySeconds: 60
        periodSeconds: 30
        failureThreshold: 5
    image:
      repository: "quay.io/us-cdcgov/cdc-nbs-modernization/data-reporting-service"
      name: "observation-reporting-service"
      tag: "v1.1.9"
      pullPolicy: IfNotPresent

  # ----------------------------------------
  # Organization Reporting Service
  # ----------------------------------------
  organization-reporting:
    secrets:
      jdbc:
        secretName: "rtr-access"
        username: "organization_reporting_user"
        password: "organization_reporting_pass"
    service:
      port: 8092
      httpsPort: 443
    serviceAccount:
      create: true
      name: ''
      annotations: { }
    log:
      path: /usr/share/organization-reporting/data
    probes:
      readiness:
        enabled: true
        path: /reporting/organization-svc/status
        initialDelaySeconds: 60
        periodSeconds: 10
        failureThreshold: 5
      liveness:
        enabled: true
        path: /reporting/organization-svc/status
        initialDelaySeconds: 60
        periodSeconds: 30
        failureThreshold: 5
    image:
      repository: "quay.io/us-cdcgov/cdc-nbs-modernization/data-reporting-service"
      name: "organization-reporting-service"
      tag: "v1.1.9"
      pullPolicy: IfNotPresent

  # ----------------------------------------
  # Person Reporting Service
  # ----------------------------------------
  person-reporting:
    secrets:
      jdbc:
        secretName: "rtr-access"
        username: "person_reporting_user"
        password: "person_reporting_pass"
    service:
      port: 8091
      httpsPort: 443
    serviceAccount:
      create: true
      name: ''
      annotations: { }
    featureFlag:
      elasticSearchEnable: "true"
    log:
      path: /usr/share/person-reporting/data
    probes:
      readiness:
        enabled: true
        path: /reporting/person-svc/status
        initialDelaySeconds: 60
        periodSeconds: 10
        failureThreshold: 5
      liveness:
        enabled: true
        path: /reporting/person-svc/status
        initialDelaySeconds: 60
        periodSeconds: 30
        failureThreshold: 5
    image:
      repository: "quay.io/us-cdcgov/cdc-nbs-modernization/data-reporting-service"
      name: "person-reporting-service"
      tag: "v1.1.9"
      pullPolicy: IfNotPresent

  # ----------------------------------------
  # Post-Processing Reporting Service
  # ----------------------------------------
  post-processing-reporting:
    secrets:
      jdbc:
        secretName: "rtr-access"
        username: "post_processing_reporting_user"
        password: "post_processing_reporting_pass"
    service:
      port: 8095
      httpsPort: 443
      fixedDelay:
        cachedIds: 2
    serviceAccount:
      create: true
      name: ''
      annotations: { }
    log:
      path: /usr/share/post-processing-reporting/data
    probes:
      readiness:
        enabled: true
        path: /reporting/post-processing-svc/status
        initialDelaySeconds: 60
        periodSeconds: 10
        failureThreshold: 5
      liveness:
        enabled: true
        path: /reporting/post-processing-svc/status
        initialDelaySeconds: 60
        periodSeconds: 30
        failureThreshold: 5
    image:
      repository: "quay.io/us-cdcgov/cdc-nbs-modernization/data-reporting-service"
      name: "post-processing-reporting-service"
      tag: "v1.1.9"
      pullPolicy: IfNotPresent
