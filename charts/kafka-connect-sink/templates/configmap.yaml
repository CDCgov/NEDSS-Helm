apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "cp-kafka-connect.name" . }}-sqlserver-connect
  labels:
    app: {{ template "cp-kafka-connect.name" . }}
    chart: {{ template "cp-kafka-connect.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
data:
  create-connectors.sh: |-
    sleep 60;
    echo "Installing Connector"
    confluent-hub install --no-prompt confluentinc/kafka-connect-jdbc:10.7.6

  start-sqlServer-connector.sh: |-
    echo "Starting sqlServerConnector"
    curl --request POST --header "Accept:application/json" --header "Content-Type:application/json" "http://127.0.0.1:8083/connectors/" --data "@/etc/sqlServerConnector.json"

  sqlServerConnector.json: |-
      {{- .Values.sqlServerConnector| toPrettyJson | nindent 4 }}

  log4j.properties: |
    log4j.rootLogger={{ .Values.log_level }}, stdout
    log4j.appender.stdout=org.apache.log4j.ConsoleAppender
    log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
    log4j.appender.stdout.layout.ConversionPattern=[%d] %p %m (%c:%L)%n
