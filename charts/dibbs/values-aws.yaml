# values.yaml for AWS

replicaCount: 1

image:
  repository: ghcr.io/cdcgov/dibbs-ecr-viewer
  tag: v2.0.0-Beta
  pullPolicy: IfNotPresent

defaultResources:
  requests:
    memory: "512Mi"
    cpu: "0.25"
  limits:
    memory: "512Mi"
    cpu: "0.25"

service:
  type: ClusterIP
  port: 8080

deployments:
  - name: dibbs-fhir-converter
    containerName: fhir-converter
    resources: {}
    port: 8080
    servicePort: 8080
  - name: dibbs-ingestion
    containerName: ingestion
    resources: {}
    port: 8080
    servicePort: 8080
  - name: dibbs-message-parser
    containerName: message-parser
    resources: {}
    port: 8080
    servicePort: 8080
  - name: dibbs-orchestration
    containerName: orchestration
    resources: {}
    port: 8080
    servicePort: 80
    env:
      OTEL_METRICS: "none"
      OTEL_METRICS_EXPORTER: "none"
      INGESTION_URL: "http://dibbs-ingestion.default.svc.cluster.local:8080"
      VALIDATION_URL: "http://dibbs-validation.default.svc.cluster.local:8080"
      FHIR_CONVERTER_URL: "http://dibbs-fhir-converter.default.svc.cluster.local:8080"
      ECR_VIEWER_URL: "https://app.fts1.nbspreview.com/ecr-viewer"
      MESSAGE_PARSER_URL: "http://dibbs-message-parser.default.svc.cluster.local:8080"
      TRIGGER_CODE_REFERENCE_URL: "http://dibbs-trigger-code-reference.default.svc.cluster.local:8080"
  - name: dibbs-validation
    containerName: validation
    resources: {}
    port: 8080
    servicePort: 8080
  - name: dibbs-trigger-code-reference
    containerName: trigger-code-reference
    resources: {}
    port: 8080
    servicePort: 8080
  - name: dibbs-ecr-viewer
    containerName: ecr-viewer
    resources: {}
    port: 3000
    servicePort: 3000
    serviceAccountName: dibbs-service-account
    env:
      # AZURE_STORAGE_CONNECTION_STRING: ""
      # AZURE_CONTAINER_NAME: "dibbs"
      # CONFIG_NAME: "AZURE_INTEGRATED"
      # NBS_PUB_KEY: ""
      AWS_REGION: "us-east-1"
      ECR_BUCKET_NAME: "dibbs-ecr"
      # HOSTNAME: "0.0.0.0"
      # NBS_AUTH: 
      CONFIG_NAME: "AWS_INTEGRATED"
      NBS_PUB_KEY: |
            -----BEGIN PUBLIC KEY-----
            MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAnlA1YmmbydxQdBh7DAq0
            wUfsjR25eWZOB995mHclT3C46oLat3YLu70akLfoMXd9YcJe0d4q3sP7tS1J4QDO
            IkfapvK3ClDJR2VUERTzR9yQ+1B1Sd+MSful/V3aP9L6wPRAJmsmziizUBz+X0oN
            WTkGP/xi0F/IlyBfh2sk89JKKmgXSFbgDTD7+8L5WeRY5koR0KfDJLBcyerrcIPW
            1FyD8RbkUH78yJXc+/ThXKBNpsDTvV0k/4zqLSADIEmhQFkW8oYOfF4ufBGSnGdZ
            gPoWbKHtlK+m1sFWMq0hAtJsNKsJQocPAEO2NIxRCX4k6X9HfvCYVniDI4OdVz0V
            jTF+galQDAybgtYc9ZN8ROpePDVkCANHzniBJFOwzv2yekreqdX7M399uLB+ztDX
            Iz2RpZbGkgspl4TWvvB+eN64DJykmExImIw1nFc/6AVd3jhKSnCrckpGV3XaF8lW
            WMA6au0RXjmRa4YxO/uQbFZeFkM7aQtQK/CxqdBfG0SACcIMwU2S7Kb5+c9Hs687
            LI8j7j0oVyCiAyJ44Mi70i4A2GedyM6kzdixTmszin+c4tT8mYjmEMpJle6GLBIa
            aqEy3CVEqecFIo4ypfoo4GjTqvv/JjtxwBl1FPC+HzFkOjSoLbrDmn64NnQhXlC9
            kd+ONf43CmqDSTa3atSFq4sCAwEAAQ==
            -----END PUBLIC KEY-----

      # database_url:
      # sqlserver_user:
      # sqlserver_password:
      # sqlserver_host:
      # db_cipher:


ingress:
  enabled: true
  className: "nginx"
  #labels:
  #  app: dibbs
  tls: 
    - hosts:
        - app.fts1.nbspreview.com
      secretName: app.fts1.nbspreview.com
    - hosts:
        - dataingestion.fts1.nbspreview.com
      secretName: dataingestion.fts1.nbspreview.com
  rules:
    - host: dataingestion.fts1.nbspreview.com
      paths:
        - path: "/orchestration/"
          serviceName: dibbs-orchestration
          servicePort: 80
    - host: app.fts1.nbspreview.com
      paths:
        - path: "/ecr-viewer/"
          serviceName: dibbs-ecr-viewer
          servicePort: 3000
---